// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ğŸ¢ ÅÄ°RKETLER (MÃ¼ÅŸteri & TedarikÃ§i)
model Company {
  id        String   @id @default(uuid())
  name      String
  type      String   // CUSTOMER veya SUPPLIER
  taxNumber String?
  address   String?
  phone     String?
  email     String?
  balance   Decimal  @default(0) // + Alacak, - BorÃ§
  
  // Åirket silinirse bunlari da sil (Cascade)
  invoices     Invoice[]
  transactions Transaction[] // Åirkete baÄŸlÄ± hareketler
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ğŸ“¦ ÃœRÃœNLER
model Product {
  id          String   @id @default(uuid())
  name        String
  barcode     String?  // Barkod opsiyonel olsun
  stock       Float    @default(0) // 1.5 kg vb.
  unit        String   @default("Adet") // Kg, Adet, Koli...
  buyPrice    Decimal
  sellPrice   Decimal
  criticalQty Int      @default(10)
  
  // âœ… YENÄ° EKLENEN KDV ALANI
  vatRate     Int      @default(20) 

  licenseKey  String?  // SaaS iÃ§in eklemiÅŸtik (Opsiyonel)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Ä°liÅŸkiler...
  invoiceItems InvoiceItem[]
}

// ğŸ§¾ FATURALAR
model Invoice {
  id          String   @id @default(uuid())
  type        String   @default("SALES")
  
  // Fatura Durumu
  status      String   @default("PENDING") // PENDING (Bekliyor) veya PAID (Ã–dendi)

  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  totalAmount Decimal  @default(0)
  date        DateTime @default(now())
  
  items       InvoiceItem[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ğŸ“ FATURA KALEMLERÄ° (SatÄ±rlar)
model InvoiceItem {
  id        String  @id @default(uuid())
  
  invoiceId String
  invoice   Invoice @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  
  productId String
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  quantity  Float   // OndalÄ±klÄ± adet olabilir (1.5 kg)
  price     Decimal
  total     Decimal
}

// ğŸ‘¥ PERSONELLER
model Employee {
  id        String   @id @default(uuid())
  firstName String
  lastName  String
  title     String?
  phone     String?
  email     String?
  salary    Decimal  @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
} 

// ğŸ”‘ LÄ°SANSLAR (Yeni Model - DÄ±ÅŸarÄ±da olmalÄ±)
model License {
  id        String   @id @default(uuid())
  key       String   @unique  // Lisans AnahtarÄ±
  owner     String            // Kime ait?
  isActive  Boolean  @default(true)
  
  expiresAt DateTime?         // Kiralama bitiÅŸ tarihi

  createdAt DateTime @default(now())
}

// ğŸ’° 1. KASA & BANKA HESAPLARI
model FinancialAccount {
  id        String        @id @default(uuid())
  name      String        // Ã–rn: "Merkez Kasa", "Ziraat BankasÄ±", "Patron Cebi"
  type      AccountType   @default(CASH) // Kasa mÄ±, Banka mÄ±?
  balance   Decimal       @default(0) // Åu an iÃ§inde ne kadar para var?
  currency  String        @default("TRY") // TL, USD, EUR
  iban      String?       // Banka ise IBAN yazÄ±lÄ±r
  
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  // Ä°liÅŸkiler
  transactions Transaction[]
}

// ğŸ’¸ 2. PARA HAREKETLERÄ° (BÄ°RLEÅTÄ°RÄ°LDÄ° VE GÃœÃ‡LENDÄ°RÄ°LDÄ°)
model Transaction {
  id          String           @id @default(uuid())
  amount      Decimal          // Tutar
  type        TransactionType  // GELÄ°R (INCOME) mi GÄ°DER (EXPENSE) mi?
  description String?          // AÃ§Ä±klama: "Fatura No #123 TahsilatÄ±"
  category    String?          // Ã–rn: "SatÄ±ÅŸ", "Kira", "MaaÅŸ", "Yemek"
  date        DateTime         @default(now())

  // Ä°STEÄE BAÄLI Ä°LÄ°ÅKÄ°LER (Opsiyonel)
  // 1. Hangi kasaya girdi/Ã§Ä±ktÄ±? (Zorunlu deÄŸil, belki sadece cari hareketi?)
  account     FinancialAccount? @relation(fields: [accountId], references: [id])
  accountId   String?

  // 2. Hangi firmayla ilgili? (Opsiyonel - MaaÅŸ Ã¶demesinde firma olmaz)
  company     Company?          @relation(fields: [companyId], references: [id])
  companyId   String?

  createdAt   DateTime         @default(now())
}

// ğŸ“Œ SEÃ‡ENEKLER (ENUMS)
enum AccountType {
  CASH  // Nakit Kasa
  BANK  // Banka HesabÄ±
  POS   // Sanal Pos / Kredi KartÄ±
}

enum TransactionType {
  INCOME   // Para GiriÅŸi (+)
  EXPENSE  // Para Ã‡Ä±kÄ±ÅŸÄ± (-)
  TRANSFER // Virman (Kasadan Bankaya)
}