// backend/prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ğŸ¢ ÅÄ°RKETLER (MÃ¼ÅŸteri & TedarikÃ§i)
model Company {
  id        String   @id @default(uuid())
  name      String
  type      String   // CUSTOMER veya SUPPLIER
  taxNumber String?
  address   String?
  phone     String?
  email     String?
  balance   Decimal  @default(0) // + Alacak, - BorÃ§
  
  // Ä°liÅŸkiler
  invoices     Invoice[]
  transactions Transaction[] 
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ğŸ“¦ ÃœRÃœNLER
model Product {
  id           String   @id @default(uuid())
  name         String
  barcode      String?
  stock        Float    @default(0)
  unit         String   @default("Adet")
  buyPrice     Decimal
  sellPrice    Decimal
  criticalQty  Int      @default(10)
  vatRate      Int      @default(20) 

  licenseKey   String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  invoiceItems InvoiceItem[]
}

// ğŸ§¾ FATURALAR
model Invoice {
  id          String   @id @default(uuid())
  type        String   @default("SALES") // SALES veya PURCHASE
  status      String   @default("PENDING") // PENDING veya PAID

  companyId   String
  company     Company  @relation(fields: [companyId], references: [id], onDelete: Cascade)
  
  totalAmount Decimal  @default(0)
  date        DateTime @default(now())
  
  items       InvoiceItem[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ğŸ“ FATURA KALEMLERÄ°
model InvoiceItem {
  id        String   @id @default(uuid())
  
  invoiceId String
  invoice   Invoice  @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  
  productId String
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  
  quantity  Float
  price     Decimal
  total     Decimal
}

// ğŸ‘¥ PERSONELLER
model Employee {
  id        String   @id @default(uuid())
  firstName String
  lastName  String
  title     String?
  phone     String?
  email     String?
  salary    Decimal  @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
} 

// ğŸ”‘ LÄ°SANSLAR
model License {
  id        String   @id @default(uuid())
  key       String   @unique
  owner     String
  isActive  Boolean  @default(true)
  expiresAt DateTime?
  createdAt DateTime @default(now())
}

// ğŸ’° KASA & BANKA HESAPLARI
model FinancialAccount {
  id        String        @id @default(uuid())
  name      String        // Ã–rn: "Merkez Kasa", "Ziraat BankasÄ±"
  type      AccountType   @default(CASH)
  balance   Decimal       @default(0)
  currency  String        @default("TRY")
  iban      String?       
  
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  // Ä°liÅŸkiler
  transactions Transaction[]
  expenses     Expense[]     // Giderler buraya baÄŸlanÄ±r
}

// ğŸ’¸ PARA HAREKETLERÄ° (Tahsilat/Ã–deme)
model Transaction {
  id          String           @id @default(uuid())
  amount      Decimal
  type        TransactionType
  description String?
  category    String?
  date        DateTime         @default(now())

  // Hangi kasaya/bankaya baÄŸlÄ±?
  account     FinancialAccount? @relation(fields: [accountId], references: [id])
  accountId   String?

  // Hangi firmayla ilgili?
  company     Company?          @relation(fields: [companyId], references: [id])
  companyId   String?

  createdAt   DateTime         @default(now())
}

// âš™ï¸ GENEL AYARLAR
model Settings {
  id          String   @id @default(uuid())
  companyName String
  address     String?
  phone       String?
  email       String?
  taxId       String?
  iban        String?
  logoUrl     String?
  terms       String?
  
  updatedAt   DateTime @updatedAt
}

// ğŸ“‚ GÄ°DER KATEGORÄ°LERÄ°
model ExpenseCategory {
  id        String    @id @default(uuid())
  name      String    @unique
  expenses  Expense[]
  createdAt DateTime  @default(now())
}

// ğŸ§¾ GÄ°DERLER (Genel Harcamalar)
model Expense {
  id          String   @id @default(uuid())
  description String
  amount      Float
  date        DateTime @default(now())
  
  // Kategori Ä°liÅŸkisi
  categoryId  String
  category    ExpenseCategory @relation(fields: [categoryId], references: [id])

  // Kasa/Banka Ä°liÅŸkisi (DoÄŸru model ismi FinancialAccount olarak dÃ¼zeltildi)
  accountId   String
  account     FinancialAccount @relation(fields: [accountId], references: [id])

  createdAt   DateTime @default(now())
}

// ğŸ“Œ ENUMLAR
enum AccountType {
  CASH
  BANK
  POS
}

enum TransactionType {
  INCOME
  EXPENSE
  TRANSFER
}